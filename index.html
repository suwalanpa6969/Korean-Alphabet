<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, initial-scale=1, user-scalable=yes">
  <title>韓文40音發音工具</title>
  <style>
    :root {
      --cell-size: 50px;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: white;
      color: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    body.dark {
      background-color: #121212;
      color: white;
    }
    .toolbar {
      display: flex;
      gap: 10px;
      margin: 5px;
    }
    .toolbar button, .toolbar label {
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(20, var(--cell-size));
      grid-template-rows: repeat(20, var(--cell-size));
      overflow: auto;
      flex-grow: 1;
      max-width: 100%;
      max-height: 100%;
    }
    .cell {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ccc;
      font-size: 20px;
      cursor: pointer;
      position: relative;
    }
    .header-consonant {
      background-color: lightblue;
      font-weight: bold;
    }
    .header-vowel {
      background-color: lightgreen;
      font-weight: bold;
    }
    .romaja {
      position: absolute;
      bottom: 2px;
      font-size: 10px;
      color: black;
    }
    body.dark .romaja {
      color: white;
    }
    .hint {
      font-size: 12px;
      margin: 4px;
      opacity: 0.7;
    }

    /* 手機專用調整 */
    body.mobile .grid {
      --cell-size: 60px;
      justify-content: center;
      align-content: center;
      margin: auto;
    }
    body.mobile .toolbar {
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    body.mobile .cell {
      font-size: 22px;
      padding: 2px;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <label><input type="checkbox" id="toggleRomaja"> 顯示羅馬拼音</label>
    <button id="toggleTheme">切換黑白模式</button>
  </div>
  <div class="grid" id="grid"></div>
  <div class="hint">點擊播放發音；準確發音請參考 YT</div>

  <script>
    // 偵測裝置
    function isMobile() {
      return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }
    if (isMobile()) {
      document.body.classList.add("mobile");
    } else {
      document.body.classList.add("desktop");
    }

    const consonants = ["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ","ㄲ","ㄸ","ㅃ","ㅆ","ㅉ"];
    const vowels = ["ㅏ","ㅑ","ㅓ","ㅕ","ㅗ","ㅛ","ㅜ","ㅠ","ㅡ","ㅣ","ㅐ","ㅒ","ㅔ","ㅕ","ㅘ","ㅙ","ㅚ","ㅝ","ㅞ","ㅟ","ㅢ"];
    const romajaMap = {
      "ㄱ":"g","ㄴ":"n","ㄷ":"d","ㄹ":"r","ㅁ":"m","ㅂ":"b","ㅅ":"s","ㅇ":"ng","ㅈ":"j","ㅊ":"ch","ㅋ":"k","ㅌ":"t","ㅍ":"p","ㅎ":"h","ㄲ":"kk","ㄸ":"tt","ㅃ":"pp","ㅆ":"ss","ㅉ":"jj",
      "ㅏ":"a","ㅑ":"ya","ㅓ":"eo","ㅕ":"yeo","ㅗ":"o","ㅛ":"yo","ㅜ":"u","ㅠ":"yu","ㅡ":"eu","ㅣ":"i","ㅐ":"ae","ㅒ":"yae","ㅔ":"e","ㅘ":"wa","ㅙ":"wae","ㅚ":"oe","ㅝ":"wo","ㅞ":"we","ㅟ":"wi","ㅢ":"ui"
    };

    const grid = document.getElementById("grid");
    // 建立表格
    for (let i = 0; i <= vowels.length; i++) {
      for (let j = 0; j <= consonants.length; j++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");

        if (i === 0 && j > 0) {
          cell.textContent = consonants[j-1];
          cell.classList.add("header-consonant");
        } else if (j === 0 && i > 0) {
          cell.textContent = vowels[i-1];
          cell.classList.add("header-vowel");
        } else if (i > 0 && j > 0) {
          const syllable = consonants[j-1] + vowels[i-1];
          cell.textContent = syllable;
          cell.addEventListener("click", () => playAudio(syllable));

          const romaja = document.createElement("div");
          romaja.classList.add("romaja");
          romaja.textContent = (romajaMap[consonants[j-1]] || "") + (romajaMap[vowels[i-1]] || "");
          romaja.style.display = "none";
          cell.appendChild(romaja);
        }
        grid.appendChild(cell);
      }
    }

    // 播放音檔或 TTS
    function playAudio(text) {
      const audio = new Audio(`audio/${text}.mp3`);
      audio.onerror = () => {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "ko-KR";
        speechSynthesis.speak(utterance);
      };
      audio.play();
    }

    // 切換羅馬拼音顯示
    document.getElementById("toggleRomaja").addEventListener("change", (e) => {
      document.querySelectorAll(".romaja").forEach(r => {
        r.style.display = e.target.checked ? "block" : "none";
      });
    });

    // 切換黑白模式
    document.getElementById("toggleTheme").addEventListener("click", () => {
      document.body.classList.toggle("dark");
    });
  </script>
</body>
</html>
